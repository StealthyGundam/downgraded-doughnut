<link rel="stylesheet" href="css/access-code.css">

    <div class="access-box" id="accessBox">
        <h2>IF YOU HAVE THE ACCESS CODE, NOW WOULD BE A GOOD TIME TO USE IT.</h2>
        <div class="error" id="errorMsg"></div>
        <input type="text" id="codeInput" maxlength="6" placeholder="Enter code">
        <br>
        <button onclick="checkCode()">SUBMIT</button>
    </div>

    <script>
        
        // Auto-redirect if access code already exists
var savedCode = localStorage.getItem("accessCode") || "";

if (savedCode) {
  requestAnimationFrame(() => {
    document.dispatchEvent(new CustomEvent("spa-next-page"));
  });
}



        const CORRECT_CODE = "705634";
        let accessBox = document.getElementById('accessBox');
        let codeInput = document.getElementById('codeInput');
        let errorMsg = document.getElementById('errorMsg');

        function checkCode() {
            const input = codeInput.value.trim();
            errorMsg.textContent = "";

            if (!accessBox.dataset.stage) {
                // Stage 1: Initial access code
                if (input === CORRECT_CODE) {
                    showNewCodePrompt();
                } else if (input === "") {
                    errorMsg.textContent = "Really? Enter the code!";
                } else {
                    errorMsg.textContent = `NOPE, ${input} IS INCORRECT. TRY AGAIN HUMAN.`;
                }

            } else if (accessBox.dataset.stage === "new") {
                // Stage 2: New code creation
                if (validateNewCode(input)) {
                    localStorage.setItem("accessCode", input);

                    accessBox.innerHTML = `
        <h2>
          Your code is as unpredictable as I like it. Access granted.
          <br><br>
          You will use this code later to access the system.
          I hope you remembered it!
        </h2>
        <button type="button" onclick="continueToNext()">CONTINUE</button>
      `;
                }
            }
        }


        function continueToNext() {
            document.dispatchEvent(new CustomEvent("spa-next-page"));
        }


        function showNewCodePrompt() {
            accessBox.dataset.stage = "new";
            accessBox.innerHTML = `
      <h2>Now create a brand-new 6-digit access code.<br>Keep it unpredictable and chaotic.</h2>
      <div class="error" id="errorMsg"></div>
      <input type="text" id="codeInput" maxlength="6" placeholder="Enter new code">
      <br>
      <button onclick="checkCode()">Submit</button>
    `;
            // Update references to new input and error elements
            codeInput = document.getElementById('codeInput');
            errorMsg = document.getElementById('errorMsg');
        }

        function validateNewCode(code) {
            // Must be exactly 6 digits
            if (!/^\d{6}$/.test(code)) {
                errorMsg.textContent = "Six digits. Not five. Not seven. Focus.";
                return false;
            }

            // Easter egg
            if (code === "696969" || code === "969696") {
                errorMsg.textContent = "Nice. Immature. Predictable. Try again.";
                return false;
            }
            const digits = code.split("");

            // Must contain at least 4 unique digits
            const uniqueDigits = new Set(digits);
            if (uniqueDigits.size < 4) {
                errorMsg.textContent = "Too simple. Use at least four different numbers.";
                return false;
            }

            // No sequential numbers (forward or backward)
            for (let i = 0; i < digits.length - 1; i++) {
                const current = Number(digits[i]);
                const next = Number(digits[i + 1]);

                if (next === current + 1 || next === current - 1) {
                    errorMsg.textContent = "No sequences. Chaos only.";
                    return false;
                }
            }

            return true;
        }

    </script>

</html>









