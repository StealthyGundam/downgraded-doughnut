<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Test Your Patience</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: 'Compacta', sans-serif;
  font-size: 16px;
  color: #eee;
  text-align: center;
  background: #000000;
  background-image: url("https://cdn.prod.website-files.com/5ff36780a108495c598ce192/61a217dea2db7e386256437f_bg-dots.svg");
  background-size: .5rem;
  background-repeat: repeat;
}

h1 {
  margin-top: 20px;
  text-align: center;
  font-family: 'Franklin Gothic Condensed', sans-serif;
  font-size: clamp(30px, 8vw, 70px);
  color: #ffffff;
  white-space: nowrap;
  text-shadow:
    0 0 10px #00ffff,
    0 0 20px #006cff,
    0 0 30px #8d00ff,
    0 0 40px #ff00f5;
}

h2 {
  font-family: 'Franklin Gothic Condensed', sans-serif;
  text-align: center;
  margin: 0;
  color: #ffffff;
  font-size: 30px;
  text-shadow:
    0 0 2px #00ffff,
    0 0 4px #006cffff,
    0 0 6px #576dc9ff,
    0 0 8px #ff00f5ff;
}

section {
  margin: 30px auto;
  padding: 10px;
  border-radius: 20px;
  width: 100%;
  max-width: 410px;
  background: #131212;
  background-image: url("https://cdn.prod.website-files.com/5ff36780a108495c598ce192/647865e3c7b7fd5334b11c92_Background%20Lines.svg");
  background-position: 100% 0;
  background-repeat: no-repeat;
  background-size: 80%;
  box-shadow:
    0 0 2px #ffffff,
    0 0 6px #00ffff,
    0 0 9px #4e83ff,
    0 0 12px #a58cff,
    inset 0 0 2px #ffffff,
    inset 0 0 6px #00ffff,
    inset 0 0 9px #4e83ff,
    inset 0 0 12px #a58cff;
  text-align: center;
}

* { box-sizing: border-box; }

#timer {
  font-size: 3rem;
  font-weight: bold;
  color: #d50000;
  -webkit-text-stroke: 3px rgb(0, 0, 0);
  paint-order: stroke fill;
  text-align: center;
}

#continueBtn {
  display: none;
  font-family: 'Franklin Gothic Condensed', sans-serif;
  text-align: center;
  margin: 20px auto;
  font-size: 30px;
  padding: 4px 15px;
  cursor: pointer;
  background: #00c853;
  color: #eee;
  border: none;
  border-radius: 5px;
  text-shadow:
    0 0 2px #00ffff,
    0 0 4px #006cffff,
    0 0 6px #576dc9ff,
    0 0 8px #ff00f5ff;
}

#realContinueBtn {
  display: none;
  font-family: 'Franklin Gothic Condensed', sans-serif;
  margin: 20px auto;
  font-size: 34px;
  padding: 6px 20px;
  cursor: pointer;
  background: #ff1744;
  color: #fff;
  border: none;
  border-radius: 6px;
  box-shadow: 0 0 15px #ff1744;
}
</style>
</head>

<body>

<h1>Patience Skill Test</h1>

<section>
  <h2 id="instruction">Do Nothing</h2>
  <div id="timer"></div>
  <button id="continueBtn">Continue</button>
  <button id="realContinueBtn">Continue</button>
</section>

<script>
let stage = 0;
let timerInterval;
let realTotalSeconds = 0;
let fakeTotalSeconds = 0;

// Stage definitions
const stages = [
  { text: "Do Nothing", realTime: 10, fakeTime: 3*3600 + 45*60 }, // real 3 min, fake 3:45:00
  { text: "Nothing Detected", realTime: 8, fakeTime: 8 },
  { text: "Continue Doing Nothing", realTime: 12, fakeTime: 12 },
  { text: "Patience Is Required!", realTime: 15, fakeTime: 15 }
];

const timerEl = document.getElementById('timer');
const continueBtn = document.getElementById('continueBtn');
const realContinueBtn = document.getElementById('realContinueBtn');
const instructionEl = document.getElementById('instruction');

function startStage() {
  clearInterval(timerInterval);

  const current = stages[stage];
  instructionEl.textContent = current.text;
  realTotalSeconds = current.realTime;
  fakeTotalSeconds = current.fakeTime;

  updateTimer();
  timerInterval = setInterval(updateTimer, 1000);
}

function updateTimer() {
  // Display fake timer first
  const fakeHours = Math.floor(fakeTotalSeconds / 3600);
  const fakeMinutes = Math.floor((fakeTotalSeconds % 3600) / 60);
  const fakeSeconds = fakeTotalSeconds % 60;

  timerEl.textContent =
    String(fakeHours).padStart(2,'0') + ':' +
    String(fakeMinutes).padStart(2,'0') + ':' +
    String(fakeSeconds).padStart(2,'0');

  // Check if real timer is done
  if (realTotalSeconds <= 0) {
    clearInterval(timerInterval);
    if (stage < stages.length - 1) {
      continueBtn.style.display = 'inline-block';
    } else {
      realContinueBtn.style.display = 'inline-block';
    }
    return;
  }

  // Decrement timers after displaying
  fakeTotalSeconds--;
  if (fakeTotalSeconds < 0) fakeTotalSeconds = 0;

  realTotalSeconds--;
}

continueBtn.addEventListener('click', () => {
  continueBtn.style.display = 'none';
  stage++;
  startStage();
});

realContinueBtn.addEventListener('click', () => {
  window.location.href = "next.html";
});

/* ================================
   TAB / FOCUS / DEVTOOLS PUNISHMENT
   ================================ */

let tabPunishCooldown = false;

document.addEventListener("visibilitychange", () => {
  if (document.hidden) punishForLeaving();
});

window.addEventListener("blur", () => {
  punishForLeaving();
});

function punishForLeaving() {
  if (tabPunishCooldown) return;

  tabPunishCooldown = true;

  startStage();

  instructionEl.textContent = "Do Not Leave The Page!";

  setTimeout(() => { tabPunishCooldown = false; }, 1000);
}

// Dev tools detection
let devtoolsOpen = false;
setInterval(() => {
  const threshold = 160;
  const widthDiff = window.outerWidth - window.innerWidth > threshold;
  const heightDiff = window.outerHeight - window.innerHeight > threshold;

  if ((widthDiff || heightDiff) && !devtoolsOpen) {
    devtoolsOpen = true;
    punishForLeaving();
  } else if (!widthDiff && !heightDiff) {
    devtoolsOpen = false;
  }
}, 1000);

// Start first stage
startStage();
</script>

</body>
</html>
